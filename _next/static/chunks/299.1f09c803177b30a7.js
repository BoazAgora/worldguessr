(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[299],{35:(t,n,e)=>{"use strict";e.d(n,{N:()=>i,V:()=>c});var r=e(4232),l=e(5947),o=e(5073),a=e(1567),u=e(8420);function i(t,n){(0,r.useEffect)(function(){return(n.layerContainer??n.map).addLayer(t.instance),function(){n.layerContainer?.removeLayer(t.instance),n.map.removeLayer(t.instance)}},[n,t])}function c(t){return function(n){let e=(0,o.U$)(),r=t((0,u.P)(n,e),e);return(0,l.z)(e.map,n.attribution),(0,a.x)(r.current,n.eventHandlers),i(r.current,e),r}}},723:(t,n,e)=>{"use strict";e.d(n,{T:()=>o});var r=e(4232),l=e(5073);function o(t){return function(n){let e=(0,l.U$)(),o=t(n,e),{instance:a}=o.current,u=(0,r.useRef)(n.position),{position:i}=n;return(0,r.useEffect)(function(){return a.addTo(e.map),function(){a.remove()}},[e.map,a]),(0,r.useEffect)(function(){null!=i&&i!==u.current&&(a.setPosition(i),u.current=i)},[a,i]),o}}},1567:(t,n,e)=>{"use strict";e.d(n,{x:()=>l});var r=e(4232);function l(t,n){let e=(0,r.useRef)();(0,r.useEffect)(function(){return null!=n&&t.instance.on(n),e.current=n,function(){null!=e.current&&t.instance.off(e.current),e.current=null}},[t,n])}},1782:()=>{},1937:(t,n,e)=>{"use strict";e.d(n,{m:()=>u});var r=e(4986),l=e(2526),o=e(6895),a=e(4232);let u=(0,r.wk)(function(t,n){let e=new o.Tooltip(t,n.overlayContainer);return(0,l.Q)(e,n)},function(t,n,{position:e},r){(0,a.useEffect)(function(){let l=n.overlayContainer;if(null==l)return;let{instance:o}=t,a=t=>{t.tooltip===o&&(null!=e&&o.setLatLng(e),o.update(),r(!0))},u=t=>{t.tooltip===o&&r(!1)};return l.on({tooltipopen:a,tooltipclose:u}),l.bindTooltip(o),function(){l.off({tooltipopen:a,tooltipclose:u}),null!=l._map&&l.unbindTooltip()}},[t,n,r,e])})},2349:(t,n,e)=>{"use strict";e.d(n,{B7:()=>a,KU:()=>i,jU:()=>u});var r=e(4232),l=e(8477),o=e(5073);function a(t){return(0,r.forwardRef)(function(n,e){let{instance:l,context:a}=t(n).current;return(0,r.useImperativeHandle)(e,()=>l),null==n.children?null:r.createElement(o.hL,{value:a},n.children)})}function u(t){return(0,r.forwardRef)(function(n,e){let[o,a]=(0,r.useState)(!1),{instance:u}=t(n,a).current;(0,r.useImperativeHandle)(e,()=>u),(0,r.useEffect)(function(){o&&u.update()},[u,o,n.children]);let i=u._contentNode;return i?(0,l.createPortal)(n.children,i):null})}function i(t){return(0,r.forwardRef)(function(n,e){let{instance:l}=t(n).current;return(0,r.useImperativeHandle)(e,()=>l),null})}},2526:(t,n,e)=>{"use strict";e.d(n,{K:()=>o,Q:()=>l});var r=e(4232);function l(t,n,e){return Object.freeze({instance:t,context:n,container:e})}function o(t,n){return null==n?function(n,e){let l=(0,r.useRef)();return l.current||(l.current=t(n,e)),l}:function(e,l){let o=(0,r.useRef)();o.current||(o.current=t(e,l));let a=(0,r.useRef)(e),{instance:u}=o.current;return(0,r.useEffect)(function(){a.current!==e&&(n(u,e,a.current),a.current=e)},[u,e,l]),o}}},3138:(t,n,e)=>{"use strict";e.d(n,{Po:()=>u,gY:()=>a,ko:()=>o});var r=e(5073),l=e(4232);function o(){return(0,r.U$)().map}function a(t,n){let e=o();return(0,l.useEffect)(function(){return e.on(t,n),function(){e.off(t,n)}},[e,t,n]),e}function u(t){let n=o();return(0,l.useEffect)(function(){return n.on(t),function(){n.off(t)}},[n,t]),n}},4986:(t,n,e)=>{"use strict";e.d(n,{T7:()=>d,Nq:()=>p,wk:()=>g,Lt:()=>m,X3:()=>h});var r=e(2349),l=e(723),o=e(2526),a=e(35),u=e(5947),i=e(5073),c=e(1567),s=e(8420),f=e(4232);function d(t){let n=(0,o.K)(function(n,e){return(0,o.Q)(t(n),e)}),e=(0,l.T)(n);return(0,r.KU)(e)}function p(t,n){let e=(0,o.K)(t,n),l=(0,a.V)(e);return(0,r.B7)(l)}function g(t,n){var e;let l=(e=(0,o.K)(t),function(t,r){let l=(0,i.U$)(),o=e((0,s.P)(t,l),l);return(0,u.z)(l.map,t.attribution),(0,c.x)(o.current,t.eventHandlers),n(o.current,l,t,r),o});return(0,r.jU)(l)}function m(t,n){var e;let l=(e=(0,o.K)(t,n),function(t){let n=(0,i.U$)(),r=e((0,s.P)(t,n),n);(0,c.x)(r.current,t.eventHandlers),(0,a.N)(r.current,n);var l=r.current;let o=(0,f.useRef)();return(0,f.useEffect)(function(){if(t.pathOptions!==o.current){let n=t.pathOptions??{};l.instance.setStyle(n),o.current=n}},[l,t]),r});return(0,r.B7)(l)}function h(t,n){let e=(0,o.K)(t,n),l=(0,a.V)(e);return(0,r.KU)(l)}},5073:(t,n,e)=>{"use strict";e.d(n,{U$:()=>i,W4:()=>o,fB:()=>l,hL:()=>u});var r=e(4232);function l(t){return Object.freeze({__version:1,map:t})}function o(t,n){return Object.freeze({...t,...n})}let a=(0,r.createContext)(null),u=a.Provider;function i(){let t=(0,r.useContext)(a);if(null==t)throw Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return t}},5947:(t,n,e)=>{"use strict";e.d(n,{z:()=>l});var r=e(4232);function l(t,n){let e=(0,r.useRef)(n);(0,r.useEffect)(function(){n!==e.current&&null!=t.attributionControl&&(null!=e.current&&t.attributionControl.removeAttribution(e.current),null!=n&&t.attributionControl.addAttribution(n)),e.current=n},[t,n])}},6299:(t,n,e)=>{"use strict";e.r(n),e.d(n,{default:()=>x});var r=e(7876),l=e(4232),o=e(8847),a=e(3138),u=e(7152),i=e(1937),c=e(6594),s=e(9458),f=e(1173);e(1782);let d=JSON.parse('{"PolandballNik":"polandball"}');var p=e(9395),g=e(5364);let m=o(()=>e.e(651).then(e.bind(e,1032)).then(t=>t.MapContainer),{loadableGenerated:{webpack:()=>[require.resolveWeak("react-leaflet")]},ssr:!1}),h=o(()=>e.e(651).then(e.bind(e,1032)).then(t=>t.TileLayer),{loadableGenerated:{webpack:()=>[require.resolveWeak("react-leaflet")]},ssr:!1});function v(t){let{pinPoint:n,setPinPoint:e,answerShown:r,dest:o,gameOptions:u,ws:i,multiplayerState:c,playSound:s}=t,f=l.useRef(c),d=l.useRef(i);(0,l.useEffect)(()=>{f.current=c},[c]),(0,l.useEffect)(()=>{d.current=i},[i]);let p=(0,a.Po)({click(t){var n,l,o;let a=f.current,u=d.current;if(!r&&(!(null==a?void 0:a.inGame)||(null==a?void 0:a.inGame)&&!(null==a||null==(l=a.gameData)||null==(n=l.players.find(t=>{var n;return t.id===(null==a||null==(n=a.gameData)?void 0:n.myId)}))?void 0:n.final))){if(e(t.latlng),(null==a?void 0:a.inGame)&&(null==(o=a.gameData)?void 0:o.state)==="guess"&&u){let n=[t.latlng.lat,t.latlng.lng];u.send(JSON.stringify({type:"place",latLong:n,final:!1}))}if(t.latlng.lat<-85||t.latlng.lat>85||t.latlng.lng<-270||t.latlng.lng>270){let n=Math.max(-85,Math.min(85,t.latlng.lat)),e=Math.max(-270,Math.min(270,t.latlng.lng));t.target.panTo([n,e],{animate:!0})}}}});(0,l.useEffect)(()=>{let t=null==u?void 0:u.extent;p&&!r&&setTimeout(()=>{try{if(t){let n=L.latLngBounds([t[1],t[0]],[t[3],t[2]]);p.fitBounds(n)}else p.setView([30,0],2)}catch(t){}},500)},[(null==u?void 0:u.extent)?JSON.stringify(u.extent):null,p,r]),(0,l.useEffect)(()=>{n&&setTimeout(()=>{try{let t=L.latLngBounds([n,{lat:o.lat,lng:o.long}]).pad(.5);p.flyToBounds(t,{duration:.5})}catch(t){}},300)},[r]),(0,l.useEffect)(()=>{let t=setInterval(()=>{p.invalidateSize()},5);return()=>clearInterval(t)},[p])}let x=t=>{var n,e,o,a;let{shown:x,options:y,ws:b,session:M,pinPoint:j,setPinPoint:E,answerShown:C,location:w,setKm:O,guessing:z,multiplayerSentGuess:P,multiplayerState:I,showHint:R,round:T,focused:k,gameOptions:U}=t,B=l.useRef(null),N=l.useRef(),{t:S}=(0,f.B)("common"),A=(0,l.useMemo)(()=>({dest:L.icon({iconUrl:"./dest.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34]}),src:L.icon({iconUrl:"./src.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34]}),src2:L.icon({iconUrl:"./src2.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34]}),polandball:L.icon({iconUrl:"./polandball.png",iconSize:[50,82],iconAnchor:[25,41],popupAnchor:[1,5]})}),[]);(0,l.useEffect)(()=>{if(C&&j&&w){let t=j.lng,n=w.long;for(;t>180;)t-=360;for(;t<-180;)t+=360;for(;n>180;)n-=360;for(;n<-180;)n+=360;let e={lat:j.lat,lng:t},r={lat:w.lat,lng:n},l=e.distanceTo?e.distanceTo(r)/1e3:K(e,r);O(l=l>100?Math.round(l):l>10?parseFloat(l.toFixed(1)):parseFloat(l.toFixed(2)))}},[C,j,w]);let K=(t,n)=>{let e=(n.lat-t.lat)*Math.PI/180,r=(n.lng-t.lng)*Math.PI/180,l=Math.sin(e/2)*Math.sin(e/2)+Math.cos(t.lat*Math.PI/180)*Math.cos(n.lat*Math.PI/180)*Math.sin(r/2)*Math.sin(r/2);return 2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l))*6371},_=L.latLng(-85,-270),H=L.latLng(85,270),Q=L.latLngBounds(_,H);return(0,r.jsxs)(m,{center:[0,0],zoom:2,minZoom:2,maxBounds:Q,maxBoundsViscosity:1,worldCopyJump:!0,style:{height:"100%",width:"100%"},whenCreated:t=>{B.current=t},children:[(0,r.jsx)("div",{className:"mapAttr",children:(0,r.jsx)("img",{width:"60",src:"https://lh3.googleusercontent.com/d_S5gxu_S1P6NR1gXeMthZeBzkrQMHdI5uvXrpn3nfJuXpCjlqhLQKH_hbOxTHxFhp5WugVOEcl4WDrv9rmKBDOMExhKU5KmmLFQVg"})}),(0,r.jsx)(v,{playSound:()=>{N.current.play()},pinPoint:j,setPinPoint:E,answerShown:C,dest:w,gameOptions:U,ws:b,multiplayerState:I}),w&&C&&(0,r.jsx)(u.p,{position:{lat:w.lat,lng:w.long},icon:A.dest}),j&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(u.p,{position:j,icon:"polandball"===d[null==M||null==(n=M.token)?void 0:n.username]?A.polandball:A.src,children:(0,r.jsx)(i.m,{direction:"top",offset:[0,-45],opacity:1,permanent:!0,position:{lat:j.lat,lng:j.lng},children:S("yourGuess")})}),C&&w&&(0,r.jsx)(c.R,{positions:[j,{lat:w.lat,lng:w.long}]})]}),(null==I?void 0:I.inGame)&&C&&w&&(null==I||null==(e=I.gameData)?void 0:e.players.map((t,n)=>{var e;if(t.id===(null==I||null==(e=I.gameData)?void 0:e.myId)||!t.guess)return null;let l=g.env.NEXT_PUBLIC_COOLMATH?(0,p.A)(t.username):t.username,o=[t.guess[0],t.guess[1]],a="polandball"===d[l]?A.polandball:A.src2;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(u.p,{position:{lat:o[0],lng:o[1]},icon:a,children:(0,r.jsx)(i.m,{direction:"top",offset:[0,-45],opacity:1,permanent:!0,position:{lat:o[0],lng:o[1]},children:(0,r.jsx)("span",{style:{color:"black"},children:l})})},2*n),(0,r.jsx)(c.R,{positions:[{lat:o[0],lng:o[1]},{lat:w.lat,lng:w.long}],color:"green"},2*n+1)]})})),R&&w&&(0,r.jsx)(s.j,{center:{lat:w.lat,lng:w.long},radius:(o=250*(null==U?void 0:U.maxDist),o)}),(0,r.jsx)(h,{noWrap:!1,url:"https://mt{s}.google.com/vt/lyrs=".concat(null!=(a=null==y?void 0:y.mapType)?a:"m","&x={x}&y={y}&z={z}&hl=").concat(S("lang")),subdomains:["0","1","2","3"],attribution:'\xa9 <a href="https://maps.google.com">Google</a>',maxZoom:22,zoomOffset:0}),(0,r.jsx)("audio",{ref:N,src:"/plop.mp3",preload:"auto"})]})}},6594:(t,n,e)=>{"use strict";e.d(n,{R:()=>u});var r=e(4986),l=e(2526),o=e(5073),a=e(6895);let u=(0,r.Lt)(function({positions:t,...n},e){let r=new a.Polyline(t,n);return(0,l.Q)(r,(0,o.W4)(e,{overlayContainer:r}))},function(t,n,e){n.positions!==e.positions&&t.setLatLngs(n.positions)})},7152:(t,n,e)=>{"use strict";e.d(n,{p:()=>u});var r=e(4986),l=e(2526),o=e(5073),a=e(6895);let u=(0,r.Nq)(function({position:t,...n},e){let r=new a.Marker(t,n);return(0,l.Q)(r,(0,o.W4)(e,{overlayContainer:r}))},function(t,n,e){n.position!==e.position&&t.setLatLng(n.position),null!=n.icon&&n.icon!==e.icon&&t.setIcon(n.icon),null!=n.zIndexOffset&&n.zIndexOffset!==e.zIndexOffset&&t.setZIndexOffset(n.zIndexOffset),null!=n.opacity&&n.opacity!==e.opacity&&t.setOpacity(n.opacity),null!=t.dragging&&n.draggable!==e.draggable&&(!0===n.draggable?t.dragging.enable():t.dragging.disable())})},8420:(t,n,e)=>{"use strict";function r(t,n){let e=t.pane??n.pane;return e?{...t,pane:e}:t}e.d(n,{P:()=>r})},9458:(t,n,e)=>{"use strict";e.d(n,{j:()=>i});var r=e(4986),l=e(2526),o=e(5073),a=e(9594),u=e(6895);let i=(0,r.Lt)(function({center:t,children:n,...e},r){let a=new u.Circle(t,e);return(0,l.Q)(a,(0,o.W4)(r,{overlayContainer:a}))},a.s)},9594:(t,n,e)=>{"use strict";function r(t,n,e){n.center!==e.center&&t.setLatLng(n.center),null!=n.radius&&n.radius!==e.radius&&t.setRadius(n.radius)}e.d(n,{s:()=>r})}}]);