"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[470],{1062:function(e,t,n){n.d(t,{kP:function(){return i},w7:function(){return a},zB:function(){return o}});var r=n(6999);function a(){console.log("Signing out")}function o(){if(console.log("Signing in"),(0,r.y)()){console.log("In iframe");let e=window.location.href;window.open(e,"_blank")}}function i(){return console.log("Using session"),{data:null}}},2461:function(e,t,n){n.d(t,{Z:function(){return h}});var r=n(5893),a=n(7294),o=n(4173),i={MIN_LOCATIONS:5,MAX_LOCATIONS:1e5,MAX_NAME_LENGTH:30,MIN_NAME_LENGTH:3,MAX_SHORT_DESCRIPTION_LENGTH:100,MIN_SHORT_DESCRIPTION_LENGTH:20,MAX_LONG_DESCRIPTION_LENGTH:1e3,MIN_LONG_DESCRIPTION_LENGTH:100},s=n(4295);function l(e){let{map:t,setMap:n,createMap:l}=e,[c,d]=(0,a.useState)({name:t.name,description_short:t.description_short,description_long:t.description_long,data:t.data||[]}),[p,h]=(0,a.useState)(!1),m=e=>{d({...c,[e.target.name]:e.target.value})},u=(e,t)=>{let n=[...c.data];n[e]=t,d({...c,data:n})},g=e=>{let t=c.data.filter((t,n)=>n!==e);d({...c,data:t})},f=e=>{if(e.preventDefault(),c.data.length<i.MIN_LOCATIONS){o.Am.error("Need at least ".concat(i.MIN_LOCATIONS," locations"));return}if(c.data.length>i.MAX_LOCATIONS){o.Am.error("Too many locations");return}if(!c.name||!c.description_short||!c.description_long){o.Am.error("Missing fields");return}n({...t,...c,progress:!0}),l(c)};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"make-map-form",style:{gap:0},children:[(0,r.jsx)("h2",{children:"Rules"}),(0,r.jsx)("li",{children:"Use a descriptive name"}),(0,r.jsx)("li",{children:"Have helpful and informative descriptions"}),(0,r.jsxs)("li",{children:["Add at least ",i.MIN_LOCATIONS," locations"]}),(0,r.jsx)("li",{children:"You can make 1 map an hour"}),(0,r.jsx)("li",{children:"Keep all details in English (no NSFW)"}),(0,r.jsxs)("li",{style:{marginTop:"10px",fontSize:"1.4em",listStyleType:"none"},children:["Need help? ",(0,r.jsx)("a",{style:{color:"cyan"},href:"https://discord.gg/ubdJHjKtrC",target:"_blank",rel:"noreferrer",children:"Join our Discord"})]})]}),(0,r.jsxs)("form",{className:"make-map-form",onSubmit:f,children:[(0,r.jsx)("h2",{children:"Basic Info"}),(0,r.jsxs)("label",{children:[(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:["Name ",(0,r.jsxs)("span",{style:{color:c.name.length<i.MIN_NAME_LENGTH?"red":"green",marginLeft:"8px"},children:["(",c.name.length," / ",i.MAX_NAME_LENGTH,")"]})]}),(0,r.jsx)("input",{type:"text",name:"name",value:c.name,onChange:m,maxLength:i.MAX_NAME_LENGTH,minLength:i.MIN_NAME_LENGTH,style:{display:"block",marginTop:"8px"}})]}),(0,r.jsxs)("label",{children:[(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:["Short Description ",(0,r.jsxs)("span",{style:{color:c.description_short.length<i.MIN_SHORT_DESCRIPTION_LENGTH?"red":"green",marginLeft:"8px"},children:["(",c.description_short.length," / ",i.MAX_SHORT_DESCRIPTION_LENGTH,")"]})]}),(0,r.jsx)("input",{type:"text",name:"description_short",value:c.description_short,onChange:m,maxLength:i.MAX_SHORT_DESCRIPTION_LENGTH,minLength:i.MIN_SHORT_DESCRIPTION_LENGTH})]}),(0,r.jsxs)("label",{children:[(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:["Long Description ",(0,r.jsxs)("span",{style:{color:c.description_long.length<i.MIN_LONG_DESCRIPTION_LENGTH?"red":"green",marginLeft:"8px"},children:["(",c.description_long.length," / ",i.MAX_LONG_DESCRIPTION_LENGTH,")"]})]}),(0,r.jsx)("textarea",{name:"description_long",value:c.description_long,onChange:m})]})]}),(0,r.jsxs)("div",{className:"make-map-form",style:{gap:0},children:[(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,r.jsx)("h2",{style:{marginBottom:"10px"},children:"Locations"}),(0,r.jsx)("button",{type:"button",style:{padding:"3px",marginLeft:"10px"},onClick:()=>{if(0===c.data.length){o.Am.error("No locations to copy");return}navigator.clipboard.writeText(JSON.stringify(c.data)),o.Am.success("Copied entered locations to clipboard")},children:(0,r.jsx)(s.esY,{})}),c.data.length<i.MIN_LOCATIONS&&(0,r.jsxs)("span",{style:{color:"red",marginLeft:"8px"},children:["(",i.MIN_LOCATIONS-c.data.length," more needed)"]}),c.data.length>=i.MIN_LOCATIONS&&(0,r.jsxs)("span",{style:{color:"green",marginLeft:"8px"},children:["(",c.data.length," / ",i.MAX_LOCATIONS,")"]})]}),!p&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("h3",{children:"Either enter them Manually..."}),(0,r.jsxs)("span",{style:{marginBottom:"5px"},children:[(0,r.jsx)("li",{children:"Visit Google Maps on a desktop computer"}),(0,r.jsx)("li",{children:"Drag the orange figure onto the map to open a streetview"}),(0,r.jsx)("li",{children:"Copy the URL from the address bar of your browser into the textbox"}),(0,r.jsxs)("li",{children:["You can add also add JSON strings with ","{lat, lng, heading, pitch, zoom}"]})]}),c.data.map((e,t)=>(0,r.jsxs)("div",{className:"url-input-container",children:[(0,r.jsx)("input",{type:"text",name:"url-".concat(t),value:e,onChange:e=>u(t,e.target.value),className:"url-input"}),(0,r.jsx)("button",{type:"button",className:"delete-button",onClick:()=>g(t),children:"âœ– "}),(0,r.jsx)("span",{className:"validation-icon"})]},t)),(0,r.jsx)("button",{type:"button",className:"add-button",onClick:()=>{d({...c,data:[...c.data,""]})},children:"+ Add URL"}),(0,r.jsx)("br",{})]}),(0,r.jsx)("h3",{children:p?"Bulk Uploaded":"...or Bulk Upload a file"}),!p&&(0,r.jsxs)("span",{children:["Supports JSON format from ",(0,r.jsx)("a",{style:{color:"cyan"},href:"https://map-generator.vercel.app/",target:"_blank",rel:"noreferrer",children:"map-generator.vercel.app"})]}),!p&&(0,r.jsxs)("label",{htmlFor:"file-upload",className:"add-button button",style:{cursor:"pointer",padding:"8px 16px"},children:[(0,r.jsx)("input",{type:"file",accept:".json",onChange:function(e){let t=e.target.files[0],n=new FileReader;n.onload=e=>{let t=e.target.result;try{let e=function(e){if(console.log("parse map data"),"string"==typeof e)try{e=JSON.parse(e),console.log("converted to json")}catch(e){return}let t=[];if(Array.isArray(e)&&(t=e,console.log("already is array")),0===t.length){for(let n in console.log("looking for array"),e)if(Array.isArray(e[n])){console.log("found array",e[n]),t=e[n];break}}if(0===t.length){console.log("no array found");return}let n=[];return 0===(n=(n=t.map(e=>{if(!e)return;if("string"==typeof e)try{e=JSON.parse(e)}catch(t){e=function(e){let t=e.match(/@(-?\d+\.\d+),(-?\d+\.\d+)(?:,3a,(\d+)y,(-?\d+)h,(\d+)t)?/);if(!t)return null;{let e=parseFloat(t[1]),n=parseFloat(t[2]),r=t[3]?parseInt(t[3],10):null,a=t[4]?parseInt(t[4],10):null,o=t[5]?parseInt(t[5],10)-90:null;return{lat:e,lng:n,heading:a,pitch:o,zoom:null!==r?Math.log2(180/r):null}}}(e)}let t={};try{for(let t of[["latitude"],["longitude","long","lon"]])for(let n of t)void 0!==e[n]&&(e[t[0]]=e[n],delete e[n])}catch(e){return}for(let n of["lat","lng","heading","pitch","zoom"])void 0!==e[n]&&(t[n]=e[n]);if(void 0!==t.lat&&void 0!==t.lng)return t})).filter(e=>e)).length?null:n}(t);if(!e){o.Am.error("Failed to parse file");return}if((e=e.map(e=>JSON.stringify(e))).length>i.MAX_LOCATIONS){o.Am.error("More than ".concat(i.MAX_LOCATIONS," locations in file"));return}o.Am.success("Parsed "+e.length+" locations"),h(!0),d({...c,data:e})}catch(e){o.Am.error("Invalid file format")}},n.readAsText(t)},style:{overflow:"hidden",width:0,height:0,opacity:0},id:"file-upload"}),"Upload File"]}),p&&(0,r.jsx)("button",{type:"button",className:"add-button",onClick:()=>{d({...c,data:[]}),h(!1)},children:"Clear Upload"})]}),(0,r.jsx)("div",{className:"make-map-form",style:{gap:0},children:(0,r.jsx)("button",{type:"submit",onClick:f,disabled:t.progress,children:t.progress?"Loading...":"Publish"})})]})}function c(e){let{onPencilClick:t,showEditControls:n,map:i,onHeart:l,onClick:c,country:d,searchTerm:p,canHeart:h,showReviewOptions:m,secret:u,refreshHome:g}=e,f=d?'url("https://flagcdn.com/h240/'.concat(null==d?void 0:d.toLowerCase(),'.png")'):"",x=(e,t)=>{if(!t||!e||"string"!=typeof t||t.length<3)return e;let n=RegExp("(".concat(t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),")"),"gi");return e.split(n).map((e,n)=>(null==e?void 0:e.toLowerCase())===(null==t?void 0:t.toLowerCase())?(0,r.jsx)("span",{style:{backgroundColor:"darkOrange"},children:e},n):e)},v=(e,t,n)=>{e.stopPropagation();let r=null;(n||null!==(r=prompt("Please enter a reason for rejecting this map:")))&&fetch("/api/map/approveRejectMap",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({secret:u,mapId:t,action:n?"approve":"reject",rejectReason:r,resubmittable:j})}).then(e=>{e.json().then(n=>{e.ok?(o.Am.success(n.message),g({removeMap:t})):(o.Am.error(n.message),g())}).catch(e=>{console.error(e),o.Am.error("An error occurred while trying to review the map. Please try again later.")})}).catch(e=>{console.error(e),o.Am.error("An error occurred while trying to review the map. Please try again later.")})},y=(e,t)=>{e.stopPropagation(),confirm("Are you sure you want to delete this map?")&&fetch("/api/map/delete",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({secret:u,mapId:t})}).then(e=>{e.json().then(t=>{e.ok?(o.Am.success(t.message),g()):o.Am.error(t.message)}).catch(e=>{console.error(e),o.Am.error("An error occurred while trying to delete the map. Please try again later.")})}).catch(e=>{console.error(e);try{e.json().then(e=>{o.Am.error(e.message)})}catch(e){o.Am.error("An error occurred while trying to delete the map. Please try again later.")}})},[j,_]=(0,a.useState)(i.resubmittable);return(0,r.jsxs)("div",{className:"map-tile ".concat(d&&"country"),onClick:c,style:{backgroundImage:f,objectFit:"cover",backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundSize:"cover"},children:[(0,r.jsxs)("div",{className:"map-tile__header ".concat(d&&"country"),children:[(0,r.jsxs)("div",{className:"map-tile__mapdetails",children:[(0,r.jsxs)("div",{className:"map-tile__name",style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,r.jsx)("p",{children:x(i.name,p)}),!d&&(i.in_review||i.reject_reason)&&i.yours&&!i.accepted&&(0,r.jsxs)("div",{className:"map-tile__status ".concat(i.reject_reason?"rejected":"in-review"),children:[!i.accepted&&i.resubmittable&&i.reject_reason&&(0,r.jsx)("span",{children:"Rejected"}),!i.accepted&&!i.reject_reason&&(0,r.jsx)("span",{children:"In Review"}),m&&(0,r.jsxs)("div",{className:"map-tile__review-options",onClick:e=>e.stopPropagation(),children:[(0,r.jsx)("button",{className:"accept",onClick:e=>v(e,i.id,!0),children:"Accept"}),(0,r.jsx)("button",{className:"reject",onClick:e=>v(e,i.id,!1),children:"Reject"}),"resubmittable?",(0,r.jsx)("input",{type:"checkbox",id:"resubmittable",name:"resubmittable",checked:j,onChange:e=>{e.stopPropagation(),_(!j)}})]})]})]}),!i.countryMap&&i.created_by_name&&(0,r.jsxs)("div",{className:"map-tile__author",children:["by ",x(i.created_by_name,p),i.accepted&&(0,r.jsxs)("span",{style:{color:"rgba(255, 255, 255, 0.5)"},children:["\xa0 \xb7 ",function(e,t){if(e<1e3)return e.toString();let n=Math.log10(e)/3|0,r=["K","M","B","T"][n-1],a=e/Math.pow(10,3*n),o=a.toFixed(3-Math.floor(Math.log10(a))-1);return o=o.replace(/\.?0+$/,""),"".concat(o).concat(r)}(i.locations,0)," locations"]})]}),i.locations&&(0,r.jsx)("div",{className:"map-tile__author",children:(0,r.jsx)("span",{style:{color:"rgba(255, 255, 255, 0.5)"}})})]}),!d&&i.created_by_name&&!i.in_review&&!i.reject_reason&&(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[(0,r.jsxs)("button",{className:"map-tile__heart ".concat(h?"":"disabled"),onClick:e=>{e.stopPropagation(),h&&l()},disabled:!h,children:[i.hearts,"\xa0",(0,r.jsx)(s.$0H,{color:i.hearted?"red":"white",size:20})]}),(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexDirection:"column"},children:[n&&i.yours&&(0,r.jsx)("button",{className:"map-tile__delete",onClick:e=>y(e,i.id),children:(0,r.jsx)(s.Xm5,{color:"red",size:10})}),n&&i.yours&&(0,r.jsx)("button",{className:"map-tile__edit",onClick:e=>{e.stopPropagation(),fetch("/api/map/action",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({secret:u,action:"get",mapId:i.id})}).then(e=>{e.json().then(n=>{if(e.ok){let e=n.map;t({...i,data:e.data,description_long:e.description_long})}else o.Am.error(n.message)}).catch(e=>{console.error(e),o.Am.error("An error occurred while trying to retrieve the map data. Please try again later.")})}).catch(e=>{console.error(e),o.Am.error("An error occurred while trying to retrieve the map data. Please try again later.")})},children:(0,r.jsx)(s.dou,{color:"white",size:10})})]})]})]}),i.yours&&i.reject_reason&&(0,r.jsx)("div",{className:"map-tile__reject-reason",children:(0,r.jsxs)("p",{children:["Reject Reason: ",i.reject_reason]})})]})}var d=n(6794);n(9431);let p={open:!1,progress:!1,name:"",description_short:"",description_long:"",data:"",edit:!1,mapId:""};function h(e){var t,n,i,s;let h;let{inLegacy:m,gameOptions:u,setGameOptions:g,singleplayer:f,close:x,session:v,text:y,onMapClick:j,chosenMap:_,showAllCountriesOption:N}=e,[b,C]=(0,a.useState)(p),[k,A]=(0,a.useState)({message:y("loading")+"..."}),[S,T]=(0,a.useState)(""),[w,M]=(0,a.useState)([]),[O,I]=(0,a.useState)("");function L(e){var t,n;if(console.log("refreshing home",e),e){A(t=>{let n={...t};return Object.keys(n).forEach(t=>{n[t]=n[t].filter(t=>t.id!==e.removeMap)}),n});return}fetch("/api/map/mapHome",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify((null==v?void 0:null===(t=v.token)||void 0===t?void 0:t.secret)?{secret:null==v?void 0:null===(n=v.token)||void 0===n?void 0:n.secret}:{})}).then(e=>e.json()).then(e=>{A(e)}).catch(()=>{A({message:"Failed to fetch"})})}(0,a.useEffect)(()=>{L()},[null==v?void 0:null===(t=v.token)||void 0===t?void 0:t.secret,y]);let E=(0,a.useCallback)((s=e=>{if(e.length>3){var t;fetch("/api/map/searchMap",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:e,secret:null==v?void 0:null===(t=v.token)||void 0===t?void 0:t.secret})}).then(e=>e.json()).then(e=>{M(e)}).catch(()=>{o.Am.error("Failed to search maps")})}else M([])},function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];clearTimeout(h),h=setTimeout(()=>s(...t),300)}),[]);(0,a.useEffect)(()=>{E(S)},[S,E]);let R=Object.keys(k).filter(e=>"message"!==e).some(e=>("recent"===e&&w.length>0?w:k[e].filter(e=>{var t,n,r;return(null===(t=e.name)||void 0===t?void 0:t.toLowerCase().includes(null==S?void 0:S.toLowerCase()))||(null===(n=e.description_short)||void 0===n?void 0:n.toLowerCase().includes(null==S?void 0:S.toLowerCase()))||(null===(r=e.created_by_name)||void 0===r?void 0:r.toLowerCase().includes(null==S?void 0:S.toLowerCase()))})).length>0);return(0,r.jsxs)("div",{className:"mapView",children:[(0,r.jsxs)("div",{className:"mapViewNavbar",children:[(0,r.jsx)("div",{className:"mapViewLeft",children:(0,r.jsx)("button",{onClick:()=>b.open?C({...b,open:!1}):x(),className:"mapViewClose",children:b.open?y("back"):y("close")})}),(0,r.jsx)("h1",{className:"mapViewTitle",children:b.open?(null==b?void 0:b.edit)?"Edit Map":"Make Map":y("maps")}),(0,r.jsx)("div",{className:"mapViewRight",children:!b.open&&(null==v?void 0:null===(n=v.token)||void 0===n?void 0:n.secret)&&(0,r.jsx)("button",{onClick:()=>{b.edit?C({...p,open:!0}):C({...b,open:!0})},className:"mapViewMake",children:"Make Map"})})]}),f&&!m&&(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",marginBottom:"5px",marginTop:"5px"},children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{children:y("nm")}),(0,r.jsx)("input",{type:"checkbox",checked:u.nm,onChange:e=>{g({...u,nm:e.target.checked})}})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{children:y("npz")}),(0,r.jsx)("input",{type:"checkbox",checked:u.npz,onChange:e=>{g({...u,npz:e.target.checked})}})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{children:y("showRoadName")}),(0,r.jsx)("input",{type:"checkbox",checked:u.showRoadName,onChange:e=>{g({...u,showRoadName:e.target.checked})}})]})]}),!b.open&&(0,r.jsx)("div",{className:"mapSearch",children:(0,r.jsx)("input",{type:"text",placeholder:y("searchForMaps"),className:"mapSearchInput",value:S,onChange:e=>T(e.target.value)})}),!b.open&&(0,r.jsxs)("div",{children:[(null==k?void 0:k.message)&&(0,r.jsx)("span",{className:"bigSpan",children:null==k?void 0:k.message}),(0,r.jsx)("center",{children:N&&(0===S.length||(null===(i=y("allCountries"))||void 0===i?void 0:i.toLowerCase().includes(null==S?void 0:S.toLowerCase())))&&(0,r.jsx)(c,{map:{name:y("allCountries"),slug:"all"},onClick:()=>j({name:y("allCountries"),slug:"all"}),searchTerm:S})}),R?Object.keys(k).filter(e=>"message"!==e).map((e,t)=>{let n="recent"===e&&w.length>0?w:k[e].filter(e=>{var t,n,r;return(null===(t=e.name)||void 0===t?void 0:t.toLowerCase().includes(S.toLowerCase()))||(null===(n=e.description_short)||void 0===n?void 0:n.toLowerCase().includes(S.toLowerCase()))||(null===(r=e.created_by_name)||void 0===r?void 0:r.toLowerCase().includes(null==S?void 0:S.toLowerCase()))});return n.length>0?(0,r.jsxs)("div",{className:"mapSection section-".concat(e),children:[(0,r.jsxs)("h2",{className:"mapSectionTitle",children:[y(e),["myMaps","likedMaps","reviewQueue"].includes(e)&&" (".concat(n.length,")")]}),(0,r.jsx)("div",{className:"mapSectionMaps",children:(0,r.jsx)(d.lS,{drag:!0,children:"countryMaps"===e?n.map((e,t)=>t%3==0?(0,r.jsx)("div",{style:{display:"flex",flexDirection:"column"},children:n.slice(t,t+3).map((e,n)=>(0,r.jsx)(c,{map:e,onClick:()=>j(e),country:e.countryMap,searchTerm:S},t+n))},t):null):n.map((t,a)=>a%("popular"===e?3:1)==0?(0,r.jsx)("div",{style:{display:"flex",flexDirection:"column"},children:n.slice(a,a+("popular"===e?3:1)).map((n,i)=>{var s,l,d,h;return(0,r.jsx)(c,{map:n,canHeart:(null==v?void 0:null===(s=v.token)||void 0===s?void 0:s.secret)&&O!==t.id,onClick:()=>j(n),country:n.countryMap,searchTerm:S,secret:null==v?void 0:null===(l=v.token)||void 0===l?void 0:l.secret,refreshHome:L,showEditControls:t.yours&&"myMaps"===e||(null==v?void 0:null===(d=v.token)||void 0===d?void 0:d.staff),showReviewOptions:(null==v?void 0:null===(h=v.token)||void 0===h?void 0:h.staff)&&"reviewQueue"===e,onPencilClick:e=>{C({...p,open:!0,edit:!0,mapId:e.id,name:e.name,description_short:e.description_short,description_long:e.description_long,data:e.data.map(e=>JSON.stringify(e))})},onHeart:()=>{!function(e){var t,n;if(!(null==v?void 0:null===(t=v.token)||void 0===t?void 0:t.secret)){o.Am.error("Not logged in");return}I(e.id),fetch("/api/map/heartMap",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({secret:null==v?void 0:null===(n=v.token)||void 0===n?void 0:n.secret,mapId:e.id})}).then(async t=>{let n;I("");try{n=await t.json()}catch(e){o.Am.error("Unexpected Error hearting map - 1");return}if(t.ok&&n.success){(0,o.Am)(n.hearted?y("heartedMap"):y("unheartedMap"),{type:n.hearted?"success":"info"});let t=n.hearts;A(r=>{let a={...r};return Object.keys(a).forEach(r=>{a[r]=a[r].map(r=>(r.id===e.id&&(r.hearts=t,r.hearted=n.hearted),r)),"likedMaps"===r&&(n.hearted?a[r].push(e):a[r]=a[r].filter(t=>t.id!==e.id))}),a}),w.length>0&&M(r=>r.map(r=>(r.id===e.id&&(r.hearts=t,r.hearted=n.hearted),r)))}else o.Am.error(y(n.message||n.error||"unexpectedError"))}).catch(e=>{I(""),console.log(e),o.Am.error("Unexpected Error hearting map - 2")})}(t)}},a+i)})},a):null)})})]},t):null}):!(null==k?void 0:k.message)&&(0,r.jsx)("div",{className:"noResults",children:y("noResultsFound")})]}),b.open&&(0,r.jsx)(l,{map:b,setMap:C,createMap:function(e){var t,n;if(!(null==v?void 0:null===(t=v.token)||void 0===t?void 0:t.secret)){o.Am.error("Not logged in");return}fetch("/api/map/action",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:b.edit?"edit":"create",mapId:b.mapId,secret:null==v?void 0:null===(n=v.token)||void 0===n?void 0:n.secret,name:e.name,description_short:e.description_short,description_long:e.description_long,data:e.data})}).then(async e=>{let t;try{t=await e.json()}catch(e){o.Am.error("Max file limit 4mb"),C({...b,progress:!1});return}e.ok?(o.Am.success("Map "+(b.edit?"edited":"created")),C(p),L()):(C({...b,progress:!1}),o.Am.error(t.message))}).catch(()=>{C({...b,progress:!1}),o.Am.error("Unexpected Error creating map - 2")})}})]})}},7485:function(e,t,n){n.d(t,{$:function(){return r}});function r(){return{t:e=>e}}},6999:function(e,t,n){n.d(t,{R:function(){return o},y:function(){return a}});let r=[];function a(){try{return window.self!==window.top}catch(e){return!0}}function o(){try{return a()&&r.some(e=>{var t,n,r;return(null!==(r=null===(n=window)||void 0===n?void 0:null===(t=n.location)||void 0===t?void 0:t.ancestorOrigins[0])&&void 0!==r?r:document.referrer).includes(e)})}catch(e){return console.error("Piracy detection error",e),!1}}}}]);