(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[890],{7623:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>m});var n=t(7876),r=t(4232),s=t(7328),l=t(9099),o=t(7703),c=t(1213),i=t(1173),d=t(3603),u=t(6336);function m(e){var a;let{}=e,t=(0,l.useRouter)(),[m,p]=(0,r.useState)(0),[h,f]=(0,r.useState)([]),[g,w]=(0,r.useState)(o.iframe),{t:_}=(0,i.B)("common"),[x,k]=(0,r.useState)({}),j=(0,r.useRef)(null),b=(0,r.useRef)(null),v=(0,r.useRef)([]),y=(0,r.useRef)(null),[C,M]=(0,r.useState)(0);(0,r.useEffect)(()=>{var e;let{apiUrl:a}=(0,d.A)(),n=new URLSearchParams(window.location.search),r=t.query.s||t.query.slug||n.get("s")||n.get("slug");console.log("also can be the format /map/slug");let s=window.location.pathname;s.startsWith("/map/")&&!r&&(r=s.split("/map/")[1]),r&&(console.log("fetching map data for",r,(0,u.dJ)()),fetch(a+"/api/map/publicData?slug=".concat(r),{headers:{authorization:null==(e=(0,u.dJ)())?void 0:e.authorization}}).then(async e=>{if(e.ok){let a=await e.json();console.log("fetched map data:",a),k(a.mapData)}else console.error("Failed to fetch map data:",e),404===e.status&&t.push("/404")}).catch(e=>{alert("An error occurred while fetching map data")}))},[]),(0,r.useEffect)(()=>{if(!x.data)return;let e=x.data.map(e=>"//www.google.com/maps/embed/v1/streetview?key=AIzaSyA2fHNuyc768n9ZJLTrfbkWLNK3sLOK-iQ&location=".concat(e.lat,",").concat(e.lng,"&fov=60"));f(e);let a=setInterval(()=>{w(o.iframe+" "+o.fadeOut),setTimeout(()=>{let a=Math.floor(Math.random()*e.length);p(a),N(a),w(o.iframe+" "+o.fadeIn)},1e3)},5e3);return window.intervalId=a,()=>clearInterval(a)},[x.data]);let N=e=>{M(e),v.current.forEach((a,t)=>{let n=t===e,r='\n        <div style="\n          width: 20px;\n          height: 20px;\n          border-radius: 50%;\n          background-color: '.concat(n?"#4CAF50":"#ffffff",";\n          border: 3px solid ").concat(n?"#ffffff":"#4CAF50",';\n          box-shadow: 0 2px 8px rgba(0,0,0,0.4);\n          cursor: pointer;\n          transition: all 0.3s ease;\n        "></div>\n      ');a.setIcon(window.L.divIcon({html:r,className:"custom-marker",iconSize:[26,26],iconAnchor:[13,13]}))}),y.current&&y.current.refreshClusters()};return(0,r.useEffect)(()=>{if(x.data&&!b.current){if(window.L)if(x.data.length>100&&!window.L.MarkerClusterGroup){let a=document.createElement("link");a.rel="stylesheet",a.href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css",document.head.appendChild(a);let t=document.createElement("link");t.rel="stylesheet",t.href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css",document.head.appendChild(t);let n=document.createElement("script");n.src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js",n.onload=e,document.head.appendChild(n)}else e();else{let a=document.createElement("link");a.rel="stylesheet",a.href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css",document.head.appendChild(a);let t=document.createElement("script");t.src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js",t.onload=()=>{if(x.data.length>100){let a=document.createElement("link");a.rel="stylesheet",a.href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css",document.head.appendChild(a);let t=document.createElement("link");t.rel="stylesheet",t.href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css",document.head.appendChild(t);let n=document.createElement("script");n.src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js",n.onload=e,document.head.appendChild(n)}else e()},document.head.appendChild(t)}return()=>{b.current&&(b.current.remove(),b.current=null,v.current=[],y.current=null)}}function e(){if(b.current)return;let e=window.L.map(j.current,{center:[20,0],zoom:2,zoomControl:!0,scrollWheelZoom:!0,doubleClickZoom:!0,dragging:!0});window.L.tileLayer("https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',subdomains:"abcd"}).addTo(e),b.current=e;let a=x.data.length>100,t=null;if(a&&window.L.MarkerClusterGroup&&(t=window.L.markerClusterGroup({maxClusterRadius:50,iconCreateFunction:function(e){let a=e.getChildCount(),t="small";return a>=100?t="large":a>=20&&(t="medium"),new window.L.DivIcon({html:"<div><span>".concat(a,"</span></div>"),className:"marker-cluster marker-cluster-".concat(t),iconSize:new window.L.Point(40,40)})}}),e.addLayer(t),y.current=t),x.data.forEach((n,r)=>{let s=r===C,l='\n          <div style="\n            width: 20px;\n            height: 20px;\n            border-radius: 50%;\n            background-color: '.concat(s?"#4CAF50":"#ffffff",";\n            border: 3px solid ").concat(s?"#ffffff":"#4CAF50",';\n            box-shadow: 0 2px 8px rgba(0,0,0,0.4);\n            cursor: pointer;\n            transition: all 0.3s ease;\n          "></div>\n        '),c=window.L.marker([n.lat,n.lng],{icon:window.L.divIcon({html:l,className:"custom-marker",iconSize:[26,26],iconAnchor:[13,13]})});c.on("click",()=>{p(r),N(r),window.intervalId&&(clearInterval(window.intervalId),window.intervalId=null),w(o.iframe+" "+o.fadeOut),setTimeout(()=>{w(o.iframe+" "+o.fadeIn)},500)}),a&&t?t.addLayer(c):c.addTo(e),v.current.push(c)}),x.data.length>0)if(a&&t)e.fitBounds(t.getBounds().pad(.1));else{let a=new window.L.featureGroup(v.current);e.fitBounds(a.getBounds().pad(.1))}}},[x.data]),(0,n.jsxs)("div",{className:o.container,children:[(0,n.jsxs)(s,{children:[(0,n.jsx)("title",{children:(null==x?void 0:x.name)?"".concat(x.name," - WorldGuessr"):""}),(0,n.jsx)("meta",{name:"description",content:"Explore the world on WorldGuessr, a free GeoGuessr alternative. "}),(0,n.jsx)("link",{rel:"icon",type:"image/x-icon",href:"/icon.ico"}),(0,n.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"})]}),(0,n.jsx)("style",{children:"\n          .mainBody {\n            user-select: auto !important;\n            overflow: auto !important;\n          }\n\n          .custom-marker {\n            background: none !important;\n            border: none !important;\n          }\n\n          .custom-marker div:hover {\n            transform: scale(1.2);\n          }\n\n          .marker-cluster {\n            background-color: rgba(255, 255, 255, 0.8);\n            border: 2px solid #4CAF50;\n            border-radius: 50%;\n            text-align: center;\n            font-size: 12px;\n            font-weight: bold;\n            line-height: 36px;\n            color: #333;\n            cursor: pointer;\n          }\n\n          .marker-cluster-small {\n            background-color: rgba(76, 175, 80, 0.8);\n            color: white;\n          }\n\n          .marker-cluster-medium {\n            background-color: rgba(255, 152, 0, 0.8);\n            color: white;\n          }\n\n          .marker-cluster-large {\n            background-color: rgba(244, 67, 54, 0.8);\n            color: white;\n          }\n\n          .marker-cluster div {\n            width: 36px;\n            height: 36px;\n            margin-left: 2px;\n            margin-top: 2px;\n            border-radius: 50%;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n          }\n        "}),(0,n.jsxs)("main",{className:o.main,children:[(0,n.jsx)(c.A,{}),(null==x?void 0:x.name)&&(0,n.jsxs)(n.Fragment,{children:[x.in_review&&(0,n.jsx)("div",{className:o.statusMessage,children:(0,n.jsx)("p",{children:"⏳ This map is currently under review."})}),x.reject_reason&&(0,n.jsx)("div",{className:o.statusMessage,children:(0,n.jsxs)("p",{children:["❌ This map has been rejected: ",x.reject_reason]})})]}),(0,n.jsxs)("div",{className:o.branding,children:[(0,n.jsx)("h1",{children:"WorldGuessr"}),(0,n.jsx)("center",{children:(0,n.jsxs)("button",{onClick:()=>window.location.href="/".concat(window.location.search.includes("crazygames")?"?crazygames=true":""),className:o.backButton,children:["← ",_("backToGame")]})})]}),x.name&&(0,n.jsxs)("div",{className:o.mapHeader,children:[(0,n.jsxs)("div",{className:o.mapImage,children:[h.length>0&&(0,n.jsx)("div",{className:o.iframeContainer,children:(0,n.jsx)("iframe",{className:g,loading:"lazy",allowFullScreen:!0,referrerPolicy:"no-referrer-when-downgrade",src:h[m]})}),x.countryCode&&(0,n.jsx)("img",{src:"https://flagcdn.com/w2560/".concat(null==(a=x.countryCode)?void 0:a.toLowerCase(),".png"),style:{width:"100%",height:"100%",objectFit:"cover"}})]}),(0,n.jsxs)("div",{className:o.mapInfo,children:[(0,n.jsx)("h1",{children:x.name}),(0,n.jsx)("p",{children:x.description_short})]})]}),(null==x?void 0:x.name)&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("button",{className:o.playButton,onClick:()=>{window.location.href="/?map=".concat(x.countryCode||x.slug).concat(window.location.search.includes("crazygames")?"&crazygames=true":"")},children:"PLAY"}),x.data&&x.data.length>0&&(0,n.jsx)("div",{className:o.worldMapSection,children:(0,n.jsx)("div",{className:o.worldMapContainer,children:(0,n.jsx)("div",{ref:j,style:{width:"100%",height:"100%"}})})}),(0,n.jsxs)("div",{className:o.mapStats,children:[void 0!==x.plays&&(0,n.jsxs)("div",{className:o.stat,children:[(0,n.jsx)("span",{className:o.statIcon,children:"\uD83D\uDC65"}),(0,n.jsx)("span",{className:o.statValue,children:x.plays.toLocaleString()}),(0,n.jsx)("span",{className:o.statLabel,children:"Plays"})]}),x.data&&(0,n.jsxs)("div",{className:o.stat,children:[(0,n.jsx)("span",{className:o.statIcon,children:"\uD83D\uDCCD"}),(0,n.jsx)("span",{className:o.statValue,children:x.locationcnt.toLocaleString()}),(0,n.jsx)("span",{className:o.statLabel,children:"Locations"})]}),void 0!==x.hearts&&(0,n.jsxs)("div",{className:o.stat,children:[(0,n.jsx)("span",{className:o.statIcon,children:"❤️"}),(0,n.jsx)("span",{className:o.statValue,children:x.hearts.toLocaleString()}),(0,n.jsx)("span",{className:o.statLabel,children:"Hearts"})]})]}),(0,n.jsxs)("div",{className:o.mapDescription,children:[(0,n.jsx)("h2",{children:"About this map"}),x.description_long.split("\n").map((e,a)=>(0,n.jsx)("p",{children:e},a)),(0,n.jsxs)("p",{className:o.mapAuthor,children:["Created by ",(0,n.jsx)("strong",{children:x.created_by}),x.created_at&&" ".concat(x.created_at," ago")]})]})]})]})]})}t(2446)},7703:e=>{e.exports={container:"MapPage_container__xYWXo",main:"MapPage_main__9rDnn",branding:"MapPage_branding__HuPlP",backButton:"MapPage_backButton__hUtxm",statusMessage:"MapPage_statusMessage__gBAeq",mapHeader:"MapPage_mapHeader__3oQ9O",mapImage:"MapPage_mapImage__enP0P",iframeContainer:"MapPage_iframeContainer__qN9dy",iframe:"MapPage_iframe__EmsgL",fadeOut:"MapPage_fadeOut__I3Vau",fadeIn:"MapPage_fadeIn__4GKks",mapInfo:"MapPage_mapInfo__GI_qE",playButton:"MapPage_playButton__A22gH",worldMapSection:"MapPage_worldMapSection__PwwOU",worldMapContainer:"MapPage_worldMapContainer__xaRiW",mapStats:"MapPage_mapStats__q55sE",stat:"MapPage_stat__sxArn",statIcon:"MapPage_statIcon__KuDGT",statValue:"MapPage_statValue__F1uP_",statLabel:"MapPage_statLabel__9e1yA",mapDescription:"MapPage_mapDescription__ymrug",mapAuthor:"MapPage_mapAuthor__oups6",pageSlideIn:"MapPage_pageSlideIn__42_WF"}},8032:(e,a,t)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/map",function(){return t(7623)}])}},e=>{e.O(0,[585,938,986,819,552,213,636,593,792],()=>e(e.s=8032)),_N_E=e.O()}]);