(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[299],{35:(t,n,e)=>{"use strict";e.d(n,{N:()=>a,V:()=>c});var r=e(4232),l=e(5947),o=e(5073),u=e(1567),i=e(8420);function a(t,n){(0,r.useEffect)(function(){return(n.layerContainer??n.map).addLayer(t.instance),function(){n.layerContainer?.removeLayer(t.instance),n.map.removeLayer(t.instance)}},[n,t])}function c(t){return function(n){let e=(0,o.U$)(),r=t((0,i.P)(n,e),e);return(0,l.z)(e.map,n.attribution),(0,u.x)(r.current,n.eventHandlers),a(r.current,e),r}}},723:(t,n,e)=>{"use strict";e.d(n,{T:()=>o});var r=e(4232),l=e(5073);function o(t){return function(n){let e=(0,l.U$)(),o=t(n,e),{instance:u}=o.current,i=(0,r.useRef)(n.position),{position:a}=n;return(0,r.useEffect)(function(){return u.addTo(e.map),function(){u.remove()}},[e.map,u]),(0,r.useEffect)(function(){null!=a&&a!==i.current&&(u.setPosition(a),i.current=a)},[u,a]),o}}},1567:(t,n,e)=>{"use strict";e.d(n,{x:()=>l});var r=e(4232);function l(t,n){let e=(0,r.useRef)();(0,r.useEffect)(function(){return null!=n&&t.instance.on(n),e.current=n,function(){null!=e.current&&t.instance.off(e.current),e.current=null}},[t,n])}},1782:()=>{},1937:(t,n,e)=>{"use strict";e.d(n,{m:()=>i});var r=e(4986),l=e(2526),o=e(6895),u=e(4232);let i=(0,r.wk)(function(t,n){let e=new o.Tooltip(t,n.overlayContainer);return(0,l.Q)(e,n)},function(t,n,{position:e},r){(0,u.useEffect)(function(){let l=n.overlayContainer;if(null==l)return;let{instance:o}=t,u=t=>{t.tooltip===o&&(null!=e&&o.setLatLng(e),o.update(),r(!0))},i=t=>{t.tooltip===o&&r(!1)};return l.on({tooltipopen:u,tooltipclose:i}),l.bindTooltip(o),function(){l.off({tooltipopen:u,tooltipclose:i}),null!=l._map&&l.unbindTooltip()}},[t,n,r,e])})},2349:(t,n,e)=>{"use strict";e.d(n,{B7:()=>u,KU:()=>a,jU:()=>i});var r=e(4232),l=e(8477),o=e(5073);function u(t){return(0,r.forwardRef)(function(n,e){let{instance:l,context:u}=t(n).current;return(0,r.useImperativeHandle)(e,()=>l),null==n.children?null:r.createElement(o.hL,{value:u},n.children)})}function i(t){return(0,r.forwardRef)(function(n,e){let[o,u]=(0,r.useState)(!1),{instance:i}=t(n,u).current;(0,r.useImperativeHandle)(e,()=>i),(0,r.useEffect)(function(){o&&i.update()},[i,o,n.children]);let a=i._contentNode;return a?(0,l.createPortal)(n.children,a):null})}function a(t){return(0,r.forwardRef)(function(n,e){let{instance:l}=t(n).current;return(0,r.useImperativeHandle)(e,()=>l),null})}},2526:(t,n,e)=>{"use strict";e.d(n,{K:()=>o,Q:()=>l});var r=e(4232);function l(t,n,e){return Object.freeze({instance:t,context:n,container:e})}function o(t,n){return null==n?function(n,e){let l=(0,r.useRef)();return l.current||(l.current=t(n,e)),l}:function(e,l){let o=(0,r.useRef)();o.current||(o.current=t(e,l));let u=(0,r.useRef)(e),{instance:i}=o.current;return(0,r.useEffect)(function(){u.current!==e&&(n(i,e,u.current),u.current=e)},[i,e,l]),o}}},3138:(t,n,e)=>{"use strict";e.d(n,{Po:()=>i,gY:()=>u,ko:()=>o});var r=e(5073),l=e(4232);function o(){return(0,r.U$)().map}function u(t,n){let e=o();return(0,l.useEffect)(function(){return e.on(t,n),function(){e.off(t,n)}},[e,t,n]),e}function i(t){let n=o();return(0,l.useEffect)(function(){return n.on(t),function(){n.off(t)}},[n,t]),n}},4986:(t,n,e)=>{"use strict";e.d(n,{T7:()=>d,Nq:()=>p,wk:()=>g,Lt:()=>m,X3:()=>v});var r=e(2349),l=e(723),o=e(2526),u=e(35),i=e(5947),a=e(5073),c=e(1567),s=e(8420),f=e(4232);function d(t){let n=(0,o.K)(function(n,e){return(0,o.Q)(t(n),e)}),e=(0,l.T)(n);return(0,r.KU)(e)}function p(t,n){let e=(0,o.K)(t,n),l=(0,u.V)(e);return(0,r.B7)(l)}function g(t,n){var e;let l=(e=(0,o.K)(t),function(t,r){let l=(0,a.U$)(),o=e((0,s.P)(t,l),l);return(0,i.z)(l.map,t.attribution),(0,c.x)(o.current,t.eventHandlers),n(o.current,l,t,r),o});return(0,r.jU)(l)}function m(t,n){var e;let l=(e=(0,o.K)(t,n),function(t){let n=(0,a.U$)(),r=e((0,s.P)(t,n),n);(0,c.x)(r.current,t.eventHandlers),(0,u.N)(r.current,n);var l=r.current;let o=(0,f.useRef)();return(0,f.useEffect)(function(){if(t.pathOptions!==o.current){let n=t.pathOptions??{};l.instance.setStyle(n),o.current=n}},[l,t]),r});return(0,r.B7)(l)}function v(t,n){let e=(0,o.K)(t,n),l=(0,u.V)(e);return(0,r.KU)(l)}},5073:(t,n,e)=>{"use strict";e.d(n,{U$:()=>a,W4:()=>o,fB:()=>l,hL:()=>i});var r=e(4232);function l(t){return Object.freeze({__version:1,map:t})}function o(t,n){return Object.freeze({...t,...n})}let u=(0,r.createContext)(null),i=u.Provider;function a(){let t=(0,r.useContext)(u);if(null==t)throw Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return t}},5947:(t,n,e)=>{"use strict";e.d(n,{z:()=>l});var r=e(4232);function l(t,n){let e=(0,r.useRef)(n);(0,r.useEffect)(function(){n!==e.current&&null!=t.attributionControl&&(null!=e.current&&t.attributionControl.removeAttribution(e.current),null!=n&&t.attributionControl.addAttribution(n)),e.current=n},[t,n])}},6299:(t,n,e)=>{"use strict";e.r(n),e.d(n,{default:()=>x});var r=e(7876),l=e(4232),o=e(8847),u=e(3138),i=e(7152),a=e(1937),c=e(6594),s=e(9458),f=e(1173);e(1782);let d=JSON.parse('{"PolandballNik":"polandball"}');var p=e(9395),g=e(5364);let m=o(()=>e.e(651).then(e.bind(e,1032)).then(t=>t.MapContainer),{loadableGenerated:{webpack:()=>[require.resolveWeak("react-leaflet")]},ssr:!1}),v=o(()=>e.e(651).then(e.bind(e,1032)).then(t=>t.TileLayer),{loadableGenerated:{webpack:()=>[require.resolveWeak("react-leaflet")]},ssr:!1});function h(t){let{pinPoint:n,setPinPoint:e,answerShown:r,dest:o,gameOptions:i,ws:a,multiplayerState:c,playSound:s}=t,f=l.useRef(c),d=l.useRef(a);(0,l.useEffect)(()=>{f.current=c},[c]),(0,l.useEffect)(()=>{d.current=a},[a]);let p=(0,u.Po)({dragend(t){let n=t.target.getCenter(),e=n.lng;for(;e>180;)e-=360;for(;e<-180;)e+=360;let r=n.lat,l=e;(r<-85||r>85)&&(r=Math.max(-85,Math.min(85,r))),l<-270?l=-270:l>270&&(l=270),(r!==n.lat||l!==n.lng)&&t.target.setView([r,l],t.target.getZoom(),{animate:!0})},click(t){var n,l,o;let u=f.current,i=d.current;if(!r&&(!(null==u?void 0:u.inGame)||(null==u?void 0:u.inGame)&&!(null==u||null==(l=u.gameData)||null==(n=l.players.find(t=>{var n;return t.id===(null==u||null==(n=u.gameData)?void 0:n.myId)}))?void 0:n.final))){if(e(t.latlng),(null==u?void 0:u.inGame)&&(null==(o=u.gameData)?void 0:o.state)==="guess"&&i){let n=[t.latlng.lat,t.latlng.lng];i.send(JSON.stringify({type:"place",latLong:n,final:!1}))}if(t.latlng.lat<-85||t.latlng.lat>85||t.latlng.lng<-270||t.latlng.lng>270){let n=Math.max(-85,Math.min(85,t.latlng.lat)),e=Math.max(-270,Math.min(270,t.latlng.lng));t.target.panTo([n,e],{animate:!0})}}}});(0,l.useEffect)(()=>{let t=null==i?void 0:i.extent;p&&!r&&setTimeout(()=>{try{if(t){let n=L.latLngBounds([t[1],t[0]],[t[3],t[2]]);p.fitBounds(n)}else p.setView([30,0],2)}catch(t){}},500)},[(null==i?void 0:i.extent)?JSON.stringify(i.extent):null,p,r]),(0,l.useEffect)(()=>{n&&setTimeout(()=>{try{let t=L.latLngBounds([n,{lat:o.lat,lng:o.long}]).pad(.5);p.flyToBounds(t,{duration:.5})}catch(t){}},300)},[r]),(0,l.useEffect)(()=>{let t=setInterval(()=>{p.invalidateSize()},5);return()=>clearInterval(t)},[p])}let x=t=>{var n,e,o,u;let{shown:x,options:y,ws:b,session:j,pinPoint:C,setPinPoint:E,answerShown:w,location:O,setKm:z,guessing:R,multiplayerSentGuess:k,multiplayerState:T,showHint:U,round:P,focused:B,gameOptions:I}=t,M=l.useRef(null),N=l.useRef(),{t:S}=(0,f.B)("common"),A=(0,l.useMemo)(()=>({dest:L.icon({iconUrl:"./dest.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34]}),src:L.icon({iconUrl:"./src.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34]}),src2:L.icon({iconUrl:"./src2.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34]}),polandball:L.icon({iconUrl:"./polandball.png",iconSize:[50,82],iconAnchor:[25,41],popupAnchor:[1,5]})}),[]);(0,l.useEffect)(()=>{if(w&&C&&O){let t=C.distanceTo({lat:O.lat,lng:O.long})/1e3;z(t=t>100?Math.round(t):t>10?parseFloat(t.toFixed(1)):parseFloat(t.toFixed(2)))}},[w,C,O]);let K=L.latLng(-85,-270),_=L.latLng(85,270),H=L.latLngBounds(K,_);return(0,r.jsxs)(m,{center:[0,0],zoom:2,minZoom:2,maxBounds:H,maxBoundsViscosity:.7,worldCopyJump:!0,style:{height:"100%",width:"100%"},whenCreated:t=>{M.current=t},children:[(0,r.jsx)("div",{className:"mapAttr",children:(0,r.jsx)("img",{width:"60",src:"https://lh3.googleusercontent.com/d_S5gxu_S1P6NR1gXeMthZeBzkrQMHdI5uvXrpn3nfJuXpCjlqhLQKH_hbOxTHxFhp5WugVOEcl4WDrv9rmKBDOMExhKU5KmmLFQVg"})}),(0,r.jsx)(h,{playSound:()=>{N.current.play()},pinPoint:C,setPinPoint:E,answerShown:w,dest:O,gameOptions:I,ws:b,multiplayerState:T}),O&&w&&(0,r.jsx)(i.p,{position:{lat:O.lat,lng:O.long},icon:A.dest}),C&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.p,{position:C,icon:"polandball"===d[null==j||null==(n=j.token)?void 0:n.username]?A.polandball:A.src,children:(0,r.jsx)(a.m,{direction:"top",offset:[0,-45],opacity:1,permanent:!0,position:{lat:C.lat,lng:C.lng},children:S("yourGuess")})}),w&&O&&(0,r.jsx)(c.R,{positions:[C,{lat:O.lat,lng:O.long}]})]}),(null==T?void 0:T.inGame)&&w&&O&&(null==T||null==(e=T.gameData)?void 0:e.players.map((t,n)=>{var e;if(t.id===(null==T||null==(e=T.gameData)?void 0:e.myId)||!t.guess)return null;let l=g.env.NEXT_PUBLIC_COOLMATH?(0,p.A)(t.username):t.username,o=[t.guess[0],t.guess[1]],u="polandball"===d[l]?A.polandball:A.src2;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.p,{position:{lat:o[0],lng:o[1]},icon:u,children:(0,r.jsx)(a.m,{direction:"top",offset:[0,-45],opacity:1,permanent:!0,position:{lat:o[0],lng:o[1]},children:(0,r.jsx)("span",{style:{color:"black"},children:l})})},2*n),(0,r.jsx)(c.R,{positions:[{lat:o[0],lng:o[1]},{lat:O.lat,lng:O.long}],color:"green"},2*n+1)]})})),U&&O&&(0,r.jsx)(s.j,{center:{lat:O.lat,lng:O.long},radius:(o=250*(null==I?void 0:I.maxDist),o)}),(0,r.jsx)(v,{noWrap:!1,url:"https://mt{s}.google.com/vt/lyrs=".concat(null!=(u=null==y?void 0:y.mapType)?u:"m","&x={x}&y={y}&z={z}&hl=").concat(S("lang")),subdomains:["0","1","2","3"],attribution:'\xa9 <a href="https://maps.google.com">Google</a>',maxZoom:22,zoomOffset:0}),(0,r.jsx)("audio",{ref:N,src:"/plop.mp3",preload:"auto"})]})}},6594:(t,n,e)=>{"use strict";e.d(n,{R:()=>i});var r=e(4986),l=e(2526),o=e(5073),u=e(6895);let i=(0,r.Lt)(function({positions:t,...n},e){let r=new u.Polyline(t,n);return(0,l.Q)(r,(0,o.W4)(e,{overlayContainer:r}))},function(t,n,e){n.positions!==e.positions&&t.setLatLngs(n.positions)})},7152:(t,n,e)=>{"use strict";e.d(n,{p:()=>i});var r=e(4986),l=e(2526),o=e(5073),u=e(6895);let i=(0,r.Nq)(function({position:t,...n},e){let r=new u.Marker(t,n);return(0,l.Q)(r,(0,o.W4)(e,{overlayContainer:r}))},function(t,n,e){n.position!==e.position&&t.setLatLng(n.position),null!=n.icon&&n.icon!==e.icon&&t.setIcon(n.icon),null!=n.zIndexOffset&&n.zIndexOffset!==e.zIndexOffset&&t.setZIndexOffset(n.zIndexOffset),null!=n.opacity&&n.opacity!==e.opacity&&t.setOpacity(n.opacity),null!=t.dragging&&n.draggable!==e.draggable&&(!0===n.draggable?t.dragging.enable():t.dragging.disable())})},8420:(t,n,e)=>{"use strict";function r(t,n){let e=t.pane??n.pane;return e?{...t,pane:e}:t}e.d(n,{P:()=>r})},9458:(t,n,e)=>{"use strict";e.d(n,{j:()=>a});var r=e(4986),l=e(2526),o=e(5073),u=e(9594),i=e(6895);let a=(0,r.Lt)(function({center:t,children:n,...e},r){let u=new i.Circle(t,e);return(0,l.Q)(u,(0,o.W4)(r,{overlayContainer:u}))},u.s)},9594:(t,n,e)=>{"use strict";function r(t,n,e){n.center!==e.center&&t.setLatLng(n.center),null!=n.radius&&n.radius!==e.radius&&t.setRadius(n.radius)}e.d(n,{s:()=>r})}}]);